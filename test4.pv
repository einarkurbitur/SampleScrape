import json

size(2000,2000)

with open("songschildren_short_master.json") as infile:
    data = json.load(infile)
# start position
x = WIDTH / 2
y = HEIGHT - 50

transform(CORNER)

def prewalk(data, depth):
    preparedData = {}
    # Copy existing properties
    props = ["artist", "song", "sample", "link", "year", "genre"]
    for k in props:
        preparedData[k] = data[k]
    width = 1
    children = []
    if 'children' in data:
        childs = data['children']
        if len(childs) > 0:
            childWidth = 0
            for c in childs:
                childData = prewalk(c, depth + 1)
                children.append(childData)
                childWidth += childData["nChilds"]
            width = max(width, childWidth)
    preparedData["nChilds"] = width
    preparedData["children"] = children
    return preparedData



def segment(data, mina, maxa, prevWidth, depth):
    # print depth, mina, maxa

    # artist = data['artist']
    song = data['song']

    font(10)
    with transform():
        translate(WIDTH /2 , HEIGHT/2)
        print "r: " + str(mina + (maxa - mina) / 2.0)
        rotate(mina + (maxa - mina) / 2.0)
        gen_width = 200
        distanceFromCenter = gen_width * depth
        text (song, distanceFromCenter, 0)
        wordWidth = measure(song).width
        stroke(0.4)
        line ((distanceFromCenter - gen_width) + prevWidth, 0, distanceFromCenter, 0)
        
    if 'children' in data:
        childs = data['children']
        nChilds = data['nChilds']
        if len(childs) > 0:
            space = (maxa - mina) / (nChilds * 1.0)
            newmin = mina
            for c in childs:
                spacePerChild = space * c["nChilds"]
                segment(c, newmin, newmin + spacePerChild, wordWidth, depth + 1)
                newmin += spacePerChild


enhancedData = prewalk(data, 0)
segment(enhancedData, 0, 360, 200, 0)